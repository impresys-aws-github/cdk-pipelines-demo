var synthetics = require('Synthetics');
const log = require('SyntheticsLogger');

const apiCanaryBlueprint = async function () {

    const headers = {}
    headers['User-Agent'] = [synthetics.getCanaryUserAgentString(), headers['User-Agent']].join(' ');
    const requestOptions = {
        'hostname': process.env.API_URL.split('/')[2],
        'method': 'GET',
        'path': '/prod',
        'port': 443,
        'protocol': 'https:'
    };
    log.info(`requestOptions ${requestOptions}`);
    requestOptions['headers'] = headers;
    await synthetics.executeHttpStep('Verify GET API', requestOptions);
};

exports.handler = async (event) => {
    return await apiCanaryBlueprint(event);
};
